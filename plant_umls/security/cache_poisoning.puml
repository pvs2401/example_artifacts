@startuml
actor Attacker
participant "DNS Client" as Client
participant "DNS Server" as DNS
participant "Legitimate DNS Server" as LegitDNS

== Attacker's Fake Response ==

Client -> DNS: Request domain (e.g., example.com)
Attacker -> DNS: Fake DNS response (e.g., example.com -> 1.2.3.4)
DNS -> Client: Return fake IP (1.2.3.4)

note right of DNS
  Cache is poisoned with fake IP
end note

== Legitimate Response ==

DNS -> LegitDNS: Forward DNS query
LegitDNS -> DNS: Return correct IP (e.g., example.com -> 5.6.7.8)

note right of DNS
  Legitimate response arrives after fake response
end note

== Cache Correction ==

alt If DNS Server Correctly Validates
    DNS -> Client: Correct IP (5.6.7.8)
else If DNS Server Does Not Validate
    DNS -> Client: Continue serving fake IP (1.2.3.4)
end

@enduml